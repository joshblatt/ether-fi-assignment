<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Task Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
  </head>
  <body>
    <h1>Task Manager</h1>

    <form>
      <label for="name">Task Name:</label>
      <input type="text" id="name" />

      <label for="description">Description:</label>
      <textarea id="description"></textarea>

      <label for="due-date">Due Date:</label>
      <input type="date" id="due-date" />

      <button type="button" onclick="createTask()">Create Task</button>
    </form>

    <h2>Tasks</h2>

    <ul id="task-list"></ul>

    <script>
      // Replace with your contract address
      const contractAddress = '0x1234567890123456789012345678901234567890';

      // Replace with your contract ABI
      const contractAbi = [
        {
          inputs: [],
          name: 'tasks',
          outputs: [
            {
              components: [
                {
                  internalType: 'string',
                  name: 'name',
                  type: 'string',
                },
                {
                  internalType: 'string',
                  name: 'description',
                  type: 'string',
                },
                {
                  internalType: 'uint256',
                  name: 'dueDate',
                  type: 'uint256',
                },
                {
                  internalType: 'bool',
                  name: 'completed',
                  type: 'bool',
                },
              ],
              internalType: 'struct TaskManager.Task[]',
              name: '',
              type: 'tuple[]',
            },
          ],
          stateMutability: 'view',
          type: 'function',
        },
        {
          inputs: [
            {
              internalType: 'string',
              name: '_name',
              type: 'string',
            },
            {
              internalType: 'string',
              name: '_description',
              type: 'string',
            },
            {
              internalType: 'uint256',
              name: '_dueDate',
              type: 'uint256',
            },
          ],
          name: 'createTask',
          outputs: [],
          stateMutability: 'nonpayable',
          type: 'function',
        },
        {
          inputs: [
            {
              internalType: 'uint256',
              name: '_index',
              type: 'uint256',
            },
          ],
          name: 'markTaskComplete',
          outputs: [],
          stateMutability: 'nonpayable',
          type: 'function',
        },
        {
          inputs: [
            {
              internalType: 'uint256',
              name: '_index',
              type: 'uint256',
            },
          ],
          name: 'removeTask',
          outputs: [],
          stateMutability: 'nonpayable',
          type: 'function',
        },
      ];

      // Connect to the Ethereum network
      const web3 = new Web3(window.ethereum);

      // Get the user's Ethereum address
      window.ethereum
        .request({ method: 'eth_requestAccounts' })
        .then((accounts) => {
          const userAddress = accounts[0];

          // Load the contract instance
          const contract = new web3.eth.Contract(contractAbi, contractAddress);

          // Create a new task
          function createTask() {
            const name = document.getElementById('name').value;
            const description = document.getElementById('description').value;
            const dueDate = new Date(document.getElementById('due-date').value).getTime() / 1000; // Convert to Unix timestamp

            // Call the contract's createTask function
            contract.methods.createTask(name, description, dueDate)
                .send({ from: userAddress })
                .then(() => {
                // Clear the form and update the task list
                document.getElementById('name').value = '';
                document.getElementById('description').value = '';
                document.getElementById('due-date').value = '';
                updateTaskList();
                })
                .catch((error) => {
                console.error(error);
                });
            }
        });